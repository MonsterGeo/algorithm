# 主方法

主方法为如下形式的递归提供了一种菜谱式的求解方法：

$$
T(n) = aT(n/b)+f(n)
$$

其中$a\geq 1,b>1$是常数，而$f(n)$是渐进正函数。现在，为了使用主方法，我们要牢记三种情况。递归式描述的是这样的一种算法运行时间，它将规模位n的问题分解为a个子问题，每个子问题的规模位n/b，其中a,b都是正常数，a个子问题递归得求解，每个花费时间T(a/b)，函数f(n)包含了问题分解和子问题解合并的代价，比如在分治算法中的递归式中，a = 8,b=2,f(n) = $\Theta(n^2)$[^1]。

该递归式不是良定义的，注意到n/b有可能不是整数，为此我们使用取整符号来迫使其成为良定义$T(\lfloor n/b \rfloor)$和$T(\lceil n/b \rceil)$。

## 主定理

主方法依赖如下定理

**定理1(主定理)** 令$a\geq 1$和 $b > 1$为常数，$f(n)$是函数，$T(n)$为定义在非负整数上的递归式

$$
T(n) = aT(n/b)+f(n)
$$

其中$n/b$解释为$T(\lfloor n/b \rfloor)$或$T(\lceil n/b \rceil)$。则$T(n)$有如下渐进界

+ 若对某个常数$\epsilon > 0$，有$f(n) = O(n^{\log_b a-\epsilon})$，则$T(n) = \Theta(n^{\log_b a})$
+ 若$f(n) = \Theta(n^{\log_b a}$，则$T(n) = \Theta(n^{\log_b a} \lg n)$
+ 若对某个常数$\epsilon > 0$，有$f(n) = \Omega(n^{\log_b a+\epsilon})$，且对某个常数$c<1$，和所有足够大的n有$af(n/b) \leq cf(n)$，则$T(n) = \Theta(f(n))$

我们快速来看它的含义，实际上就是做$f(n)$和$n^{\log_b a}$的比较，第一种情况是$n^{\log_b a}$较大。第二种情况若相等，则乘上一个对数因子，第三种情况就是f(n)较大了。


### 使用主方法

首先来看下面的例子
$$
T(n) = 9T(n/3)+n
$$

其中$a = 9,b=3,f(n) = n$因此$n^{\log_b a} = n^{\log_3 9} = n^2$，这对应主方法的第一种情况，因此$T(n) = \Theta(n^2) $


现在考虑
$$
T(n) = T(2n/3)+1
$$

其中$a = 1,b=3,f(n) = 1$因此$n^{\log_b a} = n^{\log_{3/2} 1} = n^0 = 1$，这对应主方法的第二种情况，因此$T(n) = \Theta(n^0 \lg n) = \Theta(\lg n)$

最后

$$
T(n) = 3T(n/4)+n\lg n
$$
$a = 3,b=4,f(n) = n\lg n$，$n^{\log_4 3  = O(n^{0.739})} < n^1$，所以$T(n) = \Theta(n\lg n)$


下述例子无法使用主方法

$$
T(n) = 2T(n/2)+n\lg n
$$

容易证明对$a = 2,b = 2,f(n) = n\lg n$，不满足情况1，只需要注意

$$
\lim\limits_{n\to\infty}\frac{n\lg n}{n^{\log_2 2} = n} = \infty 
$$
因此第一种情况不满足，接着对第二种情况分析，由于极限值是$\infty$，理论上来说我们应该选择第三种情况的，但选择任意常数$\epsilon > 0$。$n^\epsilon$是大于$\lg n$的，因此也不满足第三种情况，它掉到了第二种和第三种情况的中间

[^1]: 分解矩阵后，注意到C11的元素其实是两个$n^2/4$的向量做点积，加法耗费常数时间，因此合并4个矩阵的代价是$\Theta(n^2)$。

## 主定理的证明

首先，我们对一些简单情况归纳，我们证明对b的幂次的主定理成立，其中b > 1

**引理: ** 令$a \geq 1$和$b > 1$是常数，$f(n)$是定义在$b$的幂上的非负函数。$T(n)$是定义在$b$的幂次上的递归式：

$$
T(n) = \begin{cases}
    \Theta(1) & \text{if} ~n = 1\\
    aT(n/b) +f(n) & \text{if}~ n = b^i
\end{cases}
$$

其中$i\in\mathbb{Z^+}$，那么
$$
T(n) = \Theta(n^{\log_b a})+ \sum^{\log_b n-1}_{j = 0} a^jf(n/b^j)
$$